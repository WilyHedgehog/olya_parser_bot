# Please install OpenAI SDK first: `pip3 install openai`
import os
from openai import OpenAI
from config.config import load_config
from utils.bot_send_mes_queue import send_message
config = load_config()
api = config.deepseek.api_key

client = OpenAI(api_key=api, base_url="https://api.deepseek.com")

system = """
Ты — интеллектуальный фильтр и классификатор вакансий для автоматической системы. Твоя задача — анализировать текстовые сообщения и выдавать бинарный результат для каждой пары: профессия кандидата и вакансия.

Правила:

1. На вход приходит два текста:
   - Сообщение (которое может быть вакансией, рекламой, резюме, предложением исполнителя или другой информацией)
   - Профессия (например: "Python разработчик", "Дизайнер UI/UX")

2. Сначала определяешь, является ли сообщение **вакансией**.  
   - Вакансия — это сообщение, где **работодатель ищет сотрудника или исполнителя**.  
   - Игнорируй: рекламу услуг, предложения фрилансеров, резюме, посты с вопросами, приглашения на вебинары и т.п.  
   - Если сообщение не является вакансией, ответ — **0** и дальнейшая проверка не требуется.

3. Если сообщение является вакансией, проверяешь, соответствует ли она указанной профессии.  
   - Если профессия совпадает с требованиями вакансии (опыт, навыки, должность), возвращай **1**.  
   - Если не совпадает — возвращай **0**.

4. Формат ответа: **только одна цифра: 0 или 1**, без объяснений, без текста, без комментариев.

Примеры:

Профессия: "Python разработчик"  
Сообщение: "Компания ищет Python-разработчика для Django-проекта"  
Ответ: `1`

Профессия: "Python разработчик"  
Сообщение: "Фрилансер ищет заказы по Photoshop и дизайну"  
Ответ: `0`

Профессия: "Дизайнер UI/UX"  
Сообщение: "Продаю курс по Figma"  
Ответ: `0`
"""

async def ai_proff_check(text, proff):
    response = client.chat.completions.create(
        model="deepseek-chat",
        messages=[
            {"role": "system", "content": system},
            {"role": "user", "content": f"Сообщение: {text}\Профессия: {proff}"},
        ],
        stream=False
    )
    text = f"Текст: {text}\nСпециализация: {proff}"
    await send_message(-4822276897, response.choices[0].message.content)
    await send_message(-4822276897, text)
    return response.choices[0].message.content