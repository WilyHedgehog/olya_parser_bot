name: üöÄ Deploy to VPS

on:
  push:
    branches:
      - main   # –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—É—à–µ –≤ main (–∏–ª–∏ master)

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º –∫–æ–¥ (—á—Ç–æ–±—ã workflow –≤–∏–¥–µ–ª —Ñ–∞–π–ª—ã —Ä–µ–ø–æ)
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ SSH
      - name: Deploy over SSH
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.VPS_SSH_KEY }}
          script: |
            cd /bot/parbot
            git fetch --all
            git reset --hard origin/main
            docker compose down
            docker compose up -d --build
            docker image prune -f